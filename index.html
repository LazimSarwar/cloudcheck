<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CloudCheck - Live Weather Dashboard</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background: #000;
      color: white;
      font-family: 'Inter', sans-serif;
      height: auto;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }

    .weather-effects {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
    }

    .sun {
      position: absolute;
      top: 50px;
      right: 100px;
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, #FFD700, #FFA500);
      border-radius: 50%;
      box-shadow: 0 0 50px #FFD700, 0 0 100px #FFA500;
      animation: sunPulse 3s ease-in-out infinite;
      filter: blur(1px);
    }

    @keyframes sunPulse {
      0%, 100% { transform: scale(1); opacity: 0.8; }
      50% { transform: scale(1.1); opacity: 1; }
    }

    .birds {
      position: absolute;
      top: 0;
      left: -100px;
      animation: flyBirds 20s linear infinite;
    }

    .bird {
      position: absolute;
      font-size: 24px;
      color: rgba(255, 255, 255, 0.7);
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }

    @keyframes flyBirds {
      0% { transform: translateX(-100px) translateY(var(--start-y)); }
      100% { transform: translateX(calc(100vw + 100px)) translateY(var(--end-y)); }
    }

    .rain-drops {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .rain-drop {
      position: absolute;
      width: 2px;
      height: 20px;
      background: linear-gradient(to bottom, rgba(255,255,255,0.8), rgba(255,255,255,0.2));
      animation: rainFall 1.5s linear infinite;
      filter: blur(0.5px);
    }

    @keyframes rainFall {
      0% {
        transform: translateY(-100px) translateX(0);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 0.5;
      }
      100% {
        transform: translateY(100vh) translateX(30px);
        opacity: 0;
      }
    }

    .clouds {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .cloud {
      position: absolute;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 50px;
      animation: floatClouds 25s linear infinite;
      filter: blur(2px);
    }

    .cloud::before,
    .cloud::after {
      content: '';
      position: absolute;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 50%;
      filter: blur(1px);
    }

    .cloud::before {
      width: 60px;
      height: 60px;
      top: -30px;
      left: 15px;
    }

    .cloud::after {
      width: 40px;
      height: 40px;
      top: -20px;
      right: 15px;
    }

    @keyframes floatClouds {
      0% { transform: translateX(-300px) translateY(var(--start-y)); }
      100% { transform: translateX(calc(100vw + 300px)) translateY(var(--end-y)); }
    }

    .snowflakes {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .snowflake {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: snowFall 8s linear infinite;
      filter: blur(1px);
    }

    @keyframes snowFall {
      0% {
        transform: translateY(-100px) translateX(0) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 0.7;
      }
      100% {
        transform: translateY(100vh) translateX(50px) rotate(360deg);
        opacity: 0;
      }
    }

    .navbar {
      margin-top: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 40px;
      z-index: 100;
      position: relative;
    }

    .logo {
      font-size: 2.5rem;
      font-weight: 700;
      background: #ffffff;
      background-size: 300% 300%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: stormShimmer 3s infinite linear;
      padding-left: 17%;
    }

    @keyframes stormShimmer {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .nav-links {
      display: flex;
      gap: 15px;
      align-items: center;
      padding-right: 17.5%;
      position: relative;
    }

    .nav-links a {
      color: #ccc;
      text-decoration: none;
      font-size: 0.95rem;
      transition: color 0.3s ease;
      position: relative;
      cursor: pointer;
    }

    .nav-links a:hover {
      color: white;
    }

    .resources-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      background: rgba(0, 0, 0, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      min-width: 250px;
      padding: 10px 0;
      z-index: 1000;
      display: none;
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
    }

    .resources-dropdown.show {
      display: block;
      animation: dropdownFade 0.3s ease;
    }

    @keyframes dropdownFade {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .resource-item {
      padding: 12px 20px;
      color: white;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: all 0.3s ease;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .resource-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(1px);
    }

    .resource-item:last-child {
      border-bottom: none;
    }

    .resource-icon {
      font-size: 1rem;
      color: #6497b1;
      width: 20px;
      text-align: center;
    }

    .resource-text {
      flex: 1;
    }

    .resource-desc {
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.6);
      margin-top: 2px;
    }

    .language-toggle {
      display: flex;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 2px;
      gap: 2px;
    }

    .lang-btn {
      font-family: 'Inter', sans-serif;
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      background: #000;
      color: #ffffff;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .lang-btn.active {
      background: rgb(255, 255, 255);
      color: rgb(0, 0, 0);
    }

    .auth-buttons {
      display: flex;
      gap: 10px;
    }

    .auth-btn {
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
    }

    .signin-btn {
      background: #000;
      border: 1px solid rgba(255, 255, 255, 0.601);
      color: white;
    }

    .signin-btn:hover {
      background: rgb(255, 255, 255);
      color: #000 !important;
    }

    .signup-btn {
      background: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.601);
      color: rgb(0, 0, 0) !important;
    }

    .signup-btn:hover {
      transform: translateY(-0.3px);
      background: rgb(0, 0, 0);
      color: #ffffff !important;
      border: 1px solid rgba(255, 255, 255, 0.601);
    }

    .dashboard {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      position: relative;
      z-index: 1;
    }

    .dashboard-card {
      width: 100%;
      max-width: 1400px;
      height: 800px;
      background: rgba(19, 19, 19, 0.3);
      backdrop-filter: blur(25px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 8px 40px rgba(0,0,0,0.6);
      padding: 30px;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
      overflow-y: scroll;
    }

    .dashboard-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .dashboard-title {
      font-size: 2.2rem;
      font-weight: 700;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #ffffff 0%, #e0e7ff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .dashboard-subtitle {
      font-size: 1.1rem;
      color: rgba(255, 255, 255, 0.8);
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.5;
    }

    .location-section {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
      align-items: center;
      position: relative;
    }

    .location-input-container {
      flex: 1;
      position: relative;
    }

    .location-input {
      width: 100%;
      padding: 15px 20px;
      border-radius: 12px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      background: rgb(0, 0, 0);
      color: white;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .location-input:focus {
      outline: none;
      border-color: #6497b1;
      box-shadow: 0 0 0 4px rgba(100, 151, 177, 0.15);
      background: rgb(0, 0, 0);
    }

    .location-input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    .location-input:-webkit-autofill,
    .location-input:-webkit-autofill:hover,
    .location-input:-webkit-autofill:focus,
    .location-input:-webkit-autofill:active {
      -webkit-box-shadow: 0 0 0 1000px #000 inset !important;
      -webkit-text-fill-color: white !important;
      background-color: #000 !important;
      border: 2px solid rgba(255, 255, 255, 0.2) !important;
      transition: background-color 5000s ease-in-out 0s;
    }

    .suggestions-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 0 0 12px 12px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 1000;
      display: none;
    }

    .suggestion-item {
      padding: 12px 20px;
      cursor: pointer;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      transition: background 0.3s ease;
      color: white;
      background: #000;
    }

    .suggestion-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .suggestion-item:last-child {
      border-bottom: none;
    }

    .location-btn {
      padding: 15px 25px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, #184257 0%, #03396c 50%, #05203a 100%);
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    .location-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(100, 151, 177, 0.4);
    }

    .weather-dashboard {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto auto auto;
      gap: 20px;
      flex: 1;
    }

    .current-weather {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 15px;
      padding: 25px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      grid-column: 1;
      grid-row: 1;
    }

    .location-display {
      font-size: 1.8rem;
      font-weight: 600;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .date-display {
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 20px;
    }

    .temp-display {
      font-size: 4rem;
      font-weight: 700;
      margin: 20px 0;
      display: flex;
      align-items: flex-start;
    }

    .weather-icon {
      font-size: 5rem;
      margin-right: 15px;
    }

    .weather-desc {
      font-size: 1.2rem;
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 20px;
    }

    .weather-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      padding-top: 2rem;
    }

    ::-webkit-scrollbar{
        width: 1px;
    }

    .detail-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .detail-icon {
      font-size: 1.2rem;
      color: #6497b1;
    }

    .weather-info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 20px;
    }

    .info-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .info-label {
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.6);
    }

    .info-value {
      font-size: 1.1rem;
      font-weight: 600;
      color: white;
    }

    .info-unit {
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.5);
    }

    .air-quality {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 15px;
      padding: 25px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      grid-column: 2;
      grid-row: 1;
    }

    .aqi-display {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 10px;
    }

    .aqi-value {
      font-size: 2.5rem;
      font-weight: 700;
    }

    .aqi-status {
      font-size: 1.1rem;
      padding: 5px 15px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.1);
    }

    .aqi-good { color: #10b981; }
    .aqi-moderate { color: #f59e0b; }
    .aqi-poor { color: #ef4444; }

    .pollutants-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }

    .pollutant-item {
      text-align: center;
      padding: 10px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
    }

    .pollutant-value {
      font-size: 1.2rem;
      font-weight: 600;
      margin: 5px 0;
    }

    .comfort-analysis {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 15px;
      padding: 25px;
      display: flex;
      flex-direction: column;
      grid-column: 1;
      grid-row: 2;
      height: fit-content;
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title i {
      color: #6497b1;
    }

    .comfort-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      flex: 1;
    }

    .comfort-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      transition: all 0.3s ease;
    }

    .comfort-card:hover {
      transform: translateY(-5px);
      background: rgba(255, 255, 255, 0.1);
    }

    .comfort-icon {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .comfort-label {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 5px;
    }

    .comfort-value {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .status-low {
      color: #10b981;
    }

    .status-medium {
      color: #f59e0b;
    }

    .status-high {
      color: #ef4444;
    }

    .forecast-section {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 15px;
      padding: 25px;
      grid-column: 2;
      grid-row: 2;
      height: fit-content;
    }

    .forecast-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      height: 100%;
    }

    .forecast-item {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: all 0.3s ease;
    }

    .forecast-item:hover {
      transform: translateX(5px);
      background: rgba(255, 255, 255, 0.08);
    }

    .forecast-day {
      font-weight: 600;
      min-width: 80px;
    }

    .forecast-icon {
      font-size: 1.8rem;
      margin: 0 15px;
    }

    .forecast-temp {
      font-weight: 600;
      min-width: 60px;
      text-align: right;
    }

    .forecast-condition {
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.9rem;
      text-align: center;
      flex: 1;
    }

    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      flex-direction: column;
      gap: 20px;
      grid-column: 1 / -1;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.1);
      border-top: 5px solid #6497b1;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .error-state {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      flex-direction: column;
      gap: 20px;
      text-align: center;
      grid-column: 1 / -1;
    }

    .error-icon {
      font-size: 4rem;
      color: #ef4444;
      margin-bottom: 20px;
    }

    @media (max-width: 1024px) {
      .weather-dashboard {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto auto;
      }
      .current-weather {
        grid-column: 1;
        grid-row: 1;
      }
      .air-quality {
        grid-column: 1;
        grid-row: 2;
      }
      .comfort-analysis {
        grid-column: 1;
        grid-row: 3;
      }
      .forecast-section {
        grid-column: 1;
        grid-row: 4;
      }
      .navbar {
        padding: 20px;
      }
      .logo {
        padding-left: 0;
      }
      .nav-links {
        padding-right: 0;
      }
      .pollutants-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      .resources-dropdown {
        left: -50px;
        min-width: 200px;
      }
    }

    @media (max-width: 768px) {
      .dashboard-card {
        height: auto;
        min-height: 700px;
      }
      .location-section {
        flex-direction: column;
        align-items: stretch;
      }
      .comfort-grid {
        grid-template-columns: 1fr;
      }
      .weather-details {
        grid-template-columns: 1fr;
      }
      .weather-info-grid {
        grid-template-columns: 1fr;
      }
      .pollutants-grid {
        grid-template-columns: 1fr;
      }
      .temp-display {
        font-size: 3rem;
      }
      .dashboard-title {
        font-size: 1.8rem;
      }
      .forecast-container {
        flex-direction: column;
      }
      .forecast-item {
        flex-direction: column;
        text-align: center;
        gap: 10px;
      }
      .resources-dropdown {
        left: -100px;
        min-width: 180px;
      }
      .nav-links {
        gap: 10px;
      }
      .auth-buttons {
        flex-direction: column;
        gap: 5px;
      }
    }
  </style>
</head>
<body>
  <div class="weather-effects" id="weatherEffects"></div>

  <div class="navbar">
    <div class="logo">cloudcheck</div>
    <div class="nav-links">
      <a href="#" id="resourcesLink">Resources <i class="fas fa-chevron-down" style="font-size: 0.8rem; margin-left: 5px;"></i></a>
      <div class="resources-dropdown" id="resourcesDropdown">
        <a href="event_weather_planner.html" class="resource-item">
          <i class="fas fa-calendar-alt resource-icon"></i>
          <div class="resource-text">
            <div>Event Weather Planner</div>
            <div class="resource-desc">Plan events with weather insights</div>
          </div>
        </a>
        <a href="sports_weather_planner.html" class="resource-item">
          <i class="fas fa-running resource-icon"></i>
          <div class="resource-text">
            <div>Sports Weather Planner</div>
            <div class="resource-desc">Optimize sports activities</div>
          </div>
        </a>
        <a href="agriculture_weather_planner.html" class="resource-item">
          <i class="fas fa-tractor resource-icon"></i>
          <div class="resource-text">
            <div>Agriculture Weather Planner</div>
            <div class="resource-desc">Agricultural planning tools</div>
          </div>
        </a>
        <a href="travel_weather_planner.html" class="resource-item">
          <i class="fas fa-suitcase-rolling resource-icon"></i>
          <div class="resource-text">
            <div>Travel Weather Planner</div>
            <div class="resource-desc">Travel planning assistance</div>
          </div>
        </a>
        <a href="emergency.html" class="resource-item">
          <i class="fas fa-exclamation-triangle resource-icon"></i>
          <div class="resource-text">
            <div>Emergency Weather</div>
            <div class="resource-desc">Critical weather alerts</div>
          </div>
        </a>
      </div>
      <a href="chatbot.html">CloudBot</a>
      <div class="language-toggle">
        <button class="lang-btn active" id="localBtn">Local</button>
        <button class="lang-btn" id="englishBtn">English</button>
      </div>
      <div class="auth-buttons">
        <a href="login.html" class="auth-btn signin-btn">Sign In</a>
        <a href="signup.html" class="auth-btn signup-btn">Sign Up</a>
      </div>
    </div>
  </div>

  <div class="dashboard">
    <div class="dashboard-card">
      <div class="dashboard-header">
        <h1 class="dashboard-title">Live Weather Dashboard</h1>
        <p class="dashboard-subtitle">Real-time weather monitoring with comprehensive atmospheric data. Get instant insights about current conditions and environmental factors.</p>
      </div>
      
      <div class="location-section">
        <div class="location-input-container">
          <input type="text" class="location-input" id="locationInput" placeholder="Enter city name or address...">
          <div class="suggestions-dropdown" id="suggestionsDropdown"></div>
        </div>
        <button class="location-btn" id="detectLocationBtn">
          <i class="fas fa-location-crosshairs"></i> Use My Location
        </button>
      </div>
      
      <div class="weather-dashboard" id="weatherDashboard">
        <div class="loading" id="loadingState">
          <div class="spinner"></div>
          <p>Detecting your location and analyzing weather data...</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const locationInput = document.getElementById('locationInput');
      const suggestionsDropdown = document.getElementById('suggestionsDropdown');
      const detectLocationBtn = document.getElementById('detectLocationBtn');
      const weatherDashboard = document.getElementById('weatherDashboard');
      const loadingState = document.getElementById('loadingState');
      const weatherEffects = document.getElementById('weatherEffects');
      const resourcesLink = document.getElementById('resourcesLink');
      const resourcesDropdown = document.getElementById('resourcesDropdown');
      const localBtn = document.getElementById('localBtn');
      const englishBtn = document.getElementById('englishBtn');

      resourcesLink.addEventListener('click', function(e) {
        e.preventDefault();
        resourcesDropdown.classList.toggle('show');
      });

      document.addEventListener('click', function(e) {
        if (!resourcesLink.contains(e.target) && !resourcesDropdown.contains(e.target)) {
          resourcesDropdown.classList.remove('show');
        }
      });

      localBtn.addEventListener('click', function() {
        localBtn.classList.add('active');
        englishBtn.classList.remove('active');
      });

      englishBtn.addEventListener('click', function() {
        englishBtn.classList.add('active');
        localBtn.classList.remove('active');
      });

      getCurrentLocation();

      detectLocationBtn.addEventListener('click', getCurrentLocation);
      
      let debounceTimer;
      locationInput.addEventListener('input', function() {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
          const query = this.value.trim();
          if (query.length > 2) {
            fetchLocationSuggestions(query);
          } else {
            suggestionsDropdown.style.display = 'none';
          }
        }, 300);
      });

      document.addEventListener('click', function(e) {
        if (!locationInput.contains(e.target) && !suggestionsDropdown.contains(e.target)) {
          suggestionsDropdown.style.display = 'none';
        }
      });

      function getCurrentLocation() {
        loadingState.style.display = 'flex';
        weatherDashboard.innerHTML = '';
        weatherDashboard.appendChild(loadingState);
        
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            position => {
              const lat = position.coords.latitude;
              const lon = position.coords.longitude;
              getAddressFromCoords(lat, lon);
              fetchWeatherData(lat, lon);
            },
            error => {
              console.error('Error getting location:', error);
              showErrorState('Unable to detect your location. Please enter it manually.');
            }
          );
        } else {
          showErrorState('Geolocation is not supported by this browser.');
        }
      }
      
      async function getAddressFromCoords(lat, lon) {
        try {
          const response = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`);
          const data = await response.json();
          locationInput.value = `${data.city}, ${data.countryName}`;
        } catch (error) {
          console.error('Error getting address:', error);
          locationInput.value = `Lat: ${lat.toFixed(4)}, Lon: ${lon.toFixed(4)}`;
        }
      }

      async function fetchLocationSuggestions(query) {
        try {
          const response = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(query)}&count=5`);
          const data = await response.json();
          
          if (data.results && data.results.length > 0) {
            showSuggestions(data.results);
          } else {
            suggestionsDropdown.style.display = 'none';
          }
        } catch (error) {
          console.error('Error fetching suggestions:', error);
          suggestionsDropdown.style.display = 'none';
        }
      }

      function showSuggestions(results) {
        suggestionsDropdown.innerHTML = '';
        results.forEach(result => {
          const item = document.createElement('div');
          item.className = 'suggestion-item';
          item.textContent = `${result.name}, ${result.country}`;
          item.addEventListener('click', () => {
            locationInput.value = `${result.name}, ${result.country}`;
            suggestionsDropdown.style.display = 'none';
            fetchWeatherData(result.latitude, result.longitude);
          });
          suggestionsDropdown.appendChild(item);
        });
        suggestionsDropdown.style.display = 'block';
      }

      async function fetchWeatherData(lat, lon) {
        try {
          loadingState.querySelector('p').textContent = 'Fetching real-time weather data...';
          
          const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,precipitation,rain,weather_code,wind_speed_10m,wind_gusts_10m,pressure_msl,visibility,uv_index&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,wind_speed_10m_max&timezone=auto&forecast_days=5`;
          
          const response = await fetch(apiUrl);
          
          if (!response.ok) {
            throw new Error('Weather API request failed');
          }
          
          const data = await response.json();
          const processedData = processOpenMeteoData(data, lat, lon);
          renderWeatherDashboard(processedData);
          updateBackgroundEffects(processedData.condition);
          loadingState.style.display = 'none';
          
        } catch (error) {
          console.error('Error fetching weather data:', error);
          showErrorState('Failed to fetch weather data. Please check your connection and try again.');
        }
      }

      function processOpenMeteoData(apiData, lat, lon) {
        const current = apiData.current;
        const daily = apiData.daily;
        
        const condition = getConditionFromCode(current.weather_code);
        
        const heatIndex = calculateHeatIndex(current.temperature_2m, current.relative_humidity_2m);
        const windChill = calculateWindChill(current.temperature_2m, current.wind_speed_10m);
        
        const veryHotRisk = heatIndex > 35 ? 'High' : heatIndex > 30 ? 'Medium' : 'Low';
        const veryColdRisk = windChill < 0 ? 'High' : windChill < 5 ? 'Medium' : 'Low';
        const veryWetRisk = current.precipitation > 15 ? 'High' : current.precipitation > 5 ? 'Medium' : 'Low';
        const veryWindyRisk = current.wind_gusts_10m > 20 ? 'High' : current.wind_gusts_10m > 10 ? 'Medium' : 'Low';
        
        const forecast = daily.time.map((time, index) => ({
          day: new Date(time).toLocaleDateString('en-US', { weekday: 'short' }),
          condition: getConditionFromCode(daily.weather_code[index]),
          temp: daily.temperature_2m_max[index].toFixed(1)
        })).slice(0, 5);

        const airQuality = generateAirQualityData(condition);
        
        return {
          location: locationInput.value || `Lat: ${lat.toFixed(4)}, Lon: ${lon.toFixed(4)}`,
          date: new Date().toLocaleDateString('en-US', { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
          }),
          condition,
          temperature: current.temperature_2m.toFixed(1),
          details: {
            humidity: `${current.relative_humidity_2m}%`,
            windSpeed: `${current.wind_speed_10m.toFixed(1)} km/h`,
            precipitation: `${current.precipitation.toFixed(1)} mm`,
            pressure: `${current.pressure_msl ? current.pressure_msl.toFixed(0) : '1013'} hPa`,
            visibility: `${current.visibility ? (current.visibility / 1000).toFixed(1) : '10'} km`,
            uvIndex: current.uv_index ? current.uv_index.toFixed(1) : '3.0',
            feelsLike: `${calculateFeelsLike(current.temperature_2m, current.relative_humidity_2m, current.wind_speed_10m).toFixed(1)}Â°C`,
            dewPoint: `${calculateDewPoint(current.temperature_2m, current.relative_humidity_2m).toFixed(1)}Â°C`
          },
          comfort: {
            veryHot: { risk: veryHotRisk, value: `${heatIndex.toFixed(1)}Â°C` },
            veryCold: { risk: veryColdRisk, value: `${windChill.toFixed(1)}Â°C` },
            veryWet: { risk: veryWetRisk, value: `${current.precipitation.toFixed(1)} mm` },
            veryWindy: { risk: veryWindyRisk, value: `${current.wind_gusts_10m.toFixed(1)} km/h` }
          },
          airQuality,
          forecast
        };
      }

      function generateAirQualityData(condition) {
        const conditions = {
          'Clear': { aqi: 25, status: 'Good', pollutants: { pm25: 12, pm10: 20, no2: 15, o3: 45, so2: 5, co: 0.5 } },
          'Cloudy': { aqi: 35, status: 'Good', pollutants: { pm25: 18, pm10: 25, no2: 20, o3: 50, so2: 8, co: 0.7 } },
          'Rain': { aqi: 15, status: 'Excellent', pollutants: { pm25: 8, pm10: 15, no2: 10, o3: 30, so2: 3, co: 0.3 } },
          'Thunderstorm': { aqi: 45, status: 'Moderate', pollutants: { pm25: 25, pm10: 35, no2: 30, o3: 60, so2: 12, co: 1.0 } }
        };
        
        return conditions[condition] || conditions['Clear'];
      }

      function updateBackgroundEffects(condition) {
        weatherEffects.innerHTML = '';
        
        if (condition === 'Clear' || condition === 'Mainly Clear') {
          const sun = document.createElement('div');
          sun.className = 'sun';
          weatherEffects.appendChild(sun);
          
          for (let i = 0; i < 8; i++) {
            const birds = document.createElement('div');
            birds.className = 'birds';
            birds.style.setProperty('--start-y', `${Math.random() * 300}px`);
            birds.style.setProperty('--end-y', `${Math.random() * 200 - 100}px`);
            birds.style.animationDelay = `${Math.random() * 10}s`;
            
            for (let j = 0; j < 3; j++) {
              const bird = document.createElement('div');
              bird.className = 'bird';
              bird.innerHTML = 'ðŸ•Šï¸';
              bird.style.left = `${j * 40}px`;
              bird.style.animationDelay = `${j * 0.5}s`;
              birds.appendChild(bird);
            }
            weatherEffects.appendChild(birds);
          }
          
        } else if (condition.includes('Rain') || condition.includes('Drizzle')) {
          const rainDrops = document.createElement('div');
          rainDrops.className = 'rain-drops';
          for (let i = 0; i < 80; i++) {
            const drop = document.createElement('div');
            drop.className = 'rain-drop';
            drop.style.left = `${Math.random() * 100}%`;
            drop.style.animationDelay = `${Math.random() * 2}s`;
            drop.style.animationDuration = `${0.8 + Math.random() * 1.2}s`;
            rainDrops.appendChild(drop);
          }
          weatherEffects.appendChild(rainDrops);
          
        } else if (condition.includes('Cloud')) {
          for (let i = 0; i < 12; i++) {
            const cloud = document.createElement('div');
            cloud.className = 'cloud';
            cloud.style.top = `${20 + Math.random() * 60}%`;
            cloud.style.width = `${80 + Math.random() * 120}px`;
            cloud.style.height = `${40 + Math.random() * 60}px`;
            cloud.style.setProperty('--start-y', `${Math.random() * 100 - 50}px`);
            cloud.style.setProperty('--end-y', `${Math.random() * 100 - 50}px`);
            cloud.style.animationDelay = `${Math.random() * 15}s`;
            cloud.style.animationDuration = `${20 + Math.random() * 15}s`;
            weatherEffects.appendChild(cloud);
          }
        } else if (condition.includes('Snow')) {
          const snowflakes = document.createElement('div');
          snowflakes.className = 'snowflakes';
          for (let i = 0; i < 60; i++) {
            const snowflake = document.createElement('div');
            snowflake.className = 'snowflake';
            snowflake.style.left = `${Math.random() * 100}%`;
            snowflake.style.width = `${3 + Math.random() * 5}px`;
            snowflake.style.height = snowflake.style.width;
            snowflake.style.animationDelay = `${Math.random() * 5}s`;
            snowflake.style.animationDuration = `${6 + Math.random() * 4}s`;
            snowflakes.appendChild(snowflake);
          }
          weatherEffects.appendChild(snowflakes);
        }
      }

      function getConditionFromCode(code) {
        const weatherCodes = {
          0: 'Clear', 1: 'Mainly Clear', 2: 'Partly Cloudy', 3: 'Cloudy',
          45: 'Fog', 48: 'Fog', 51: 'Drizzle', 53: 'Drizzle', 55: 'Drizzle',
          61: 'Rain', 63: 'Rain', 65: 'Rain', 80: 'Rain', 81: 'Rain', 82: 'Rain',
          71: 'Snow', 73: 'Snow', 75: 'Snow', 85: 'Snow', 86: 'Snow',
          95: 'Thunderstorm', 96: 'Thunderstorm', 99: 'Thunderstorm'
        };
        return weatherCodes[code] || 'Unknown';
      }
      
      function getWeatherIcon(condition) {
        switch(condition) {
          case 'Clear': return 'fa-sun';
          case 'Mainly Clear': return 'fa-sun';
          case 'Partly Cloudy': return 'fa-cloud-sun';
          case 'Cloudy': return 'fa-cloud';
          case 'Fog': return 'fa-smog';
          case 'Drizzle': return 'fa-cloud-drizzle';
          case 'Rain': return 'fa-cloud-rain';
          case 'Snow': return 'fa-snowflake';
          case 'Thunderstorm': return 'fa-bolt';
          default: return 'fa-cloud';
        }
      }
      
      function calculateHeatIndex(temp, humidity) {
        if (temp < 27) return temp;
        return temp + 0.5 * (humidity / 100) * (temp - 20);
      }
      
      function calculateWindChill(temp, windSpeed) {
        if (temp <= 10 && windSpeed > 4.8) {
          return 13.12 + 0.6215 * temp - 11.37 * Math.pow(windSpeed, 0.16) + 0.3965 * temp * Math.pow(windSpeed, 0.16);
        }
        return temp;
      }

      function calculateFeelsLike(temp, humidity, windSpeed) {
        const heatIndex = calculateHeatIndex(temp, humidity);
        const windChill = calculateWindChill(temp, windSpeed);
        return (heatIndex + windChill) / 2;
      }

      function calculateDewPoint(temp, humidity) {
        return temp - (100 - humidity) / 5;
      }
      
      function getTemperatureColor(temp) {
        if (temp < 0) return '#6497b1';
        if (temp < 10) return '#87CEEB';
        if (temp < 20) return '#F0E68C';
        if (temp < 30) return '#FFA500';
        return '#FF4500';
      }
      
      function getRiskClass(risk) {
        switch(risk) {
          case 'Low': return 'status-low';
          case 'Medium': return 'status-medium';
          case 'High': return 'status-high';
          default: return '';
        }
      }

      function getAQIClass(aqi) {
        if (aqi <= 50) return 'aqi-good';
        if (aqi <= 100) return 'aqi-moderate';
        return 'aqi-poor';
      }
      
      function renderWeatherDashboard(data) {
        const weatherIcon = getWeatherIcon(data.condition);
        const tempColor = getTemperatureColor(parseFloat(data.temperature));
        
        weatherDashboard.innerHTML = `
          <div class="current-weather">
            <div>
              <div class="location-display">
                <i class="fas fa-map-marker-alt"></i>
                ${data.location}
              </div>
              <div class="date-display">${data.date} - Live Data</div>
              <div class="temp-display" style="color: ${tempColor}">
                <i class="fas ${weatherIcon} weather-icon"></i>
                ${data.temperature}Â°C
              </div>
              <div class="weather-desc">${data.condition}</div>
              
              <div class="weather-info-grid">
                <div class="info-card">
                  <div class="info-label">Feels Like</div>
                  <div class="info-value">${data.details.feelsLike}</div>
                  <div class="info-unit">Â°C</div>
                </div>
                <div class="info-card">
                  <div class="info-label">Dew Point</div>
                  <div class="info-value">${data.details.dewPoint}</div>
                  <div class="info-unit">Â°C</div>
                </div>
                <div class="info-card">
                  <div class="info-label">UV Index</div>
                  <div class="info-value">${data.details.uvIndex}</div>
                  <div class="info-unit">Moderate</div>
                </div>
                <div class="info-card">
                  <div class="info-label">Visibility</div>
                  <div class="info-value">${data.details.visibility}</div>
                  <div class="info-unit">km</div>
                </div>
              </div>
            </div>
            <div class="weather-details">
              <div class="detail-item">
                <i class="fas fa-tint detail-icon"></i>
                <span>Humidity: ${data.details.humidity}</span>
              </div>
              <div class="detail-item">
                <i class="fas fa-wind detail-icon"></i>
                <span>Wind: ${data.details.windSpeed}</span>
              </div>
              <div class="detail-item">
                <i class="fas fa-cloud-rain detail-icon"></i>
                <span>Precipitation: ${data.details.precipitation}</span>
              </div>
              <div class="detail-item">
                <i class="fas fa-tachometer-alt detail-icon"></i>
                <span>Pressure: ${data.details.pressure}</span>
              </div>
            </div>
          </div>
          
          <div class="air-quality">
            <div class="section-title">
              <i class="fas fa-wind"></i>
              Air Quality Index
            </div>
            <div class="aqi-display">
              <div class="aqi-value ${getAQIClass(data.airQuality.aqi)}">${data.airQuality.aqi}</div>
              <div class="aqi-status ${getAQIClass(data.airQuality.aqi)}">${data.airQuality.status}</div>
            </div>
            <div class="pollutants-grid">
              <div class="pollutant-item">
                <div class="info-label">PM2.5</div>
                <div class="pollutant-value">${data.airQuality.pollutants.pm25}</div>
                <div class="info-unit">Î¼g/mÂ³</div>
              </div>
              <div class="pollutant-item">
                <div class="info-label">PM10</div>
                <div class="pollutant-value">${data.airQuality.pollutants.pm10}</div>
                <div class="info-unit">Î¼g/mÂ³</div>
              </div>
              <div class="pollutant-item">
                <div class="info-label">NOâ‚‚</div>
                <div class="pollutant-value">${data.airQuality.pollutants.no2}</div>
                <div class="info-unit">Î¼g/mÂ³</div>
              </div>
              <div class="pollutant-item">
                <div class="info-label">Oâ‚ƒ</div>
                <div class="pollutant-value">${data.airQuality.pollutants.o3}</div>
                <div class="info-unit">Î¼g/mÂ³</div>
              </div>
              <div class="pollutant-item">
                <div class="info-label">SOâ‚‚</div>
                <div class="pollutant-value">${data.airQuality.pollutants.so2}</div>
                <div class="info-unit">Î¼g/mÂ³</div>
              </div>
              <div class="pollutant-item">
                <div class="info-label">CO</div>
                <div class="pollutant-value">${data.airQuality.pollutants.co}</div>
                <div class="info-unit">mg/mÂ³</div>
              </div>
            </div>
          </div>
          
          <div class="comfort-analysis">
            <div class="section-title">
              <i class="fas fa-heartbeat"></i>
              Comfort Analysis
            </div>
            <div class="comfort-grid">
              <div class="comfort-card">
                <i class="fas fa-temperature-high comfort-icon ${getRiskClass(data.comfort.veryHot.risk)}"></i>
                <div class="comfort-label">Very Hot Risk</div>
                <div class="comfort-value ${getRiskClass(data.comfort.veryHot.risk)}">
                  ${data.comfort.veryHot.risk}
                </div>
                <div class="comfort-desc">${data.comfort.veryHot.value}</div>
              </div>
              <div class="comfort-card">
                <i class="fas fa-temperature-low comfort-icon ${getRiskClass(data.comfort.veryCold.risk)}"></i>
                <div class="comfort-label">Very Cold Risk</div>
                <div class="comfort-value ${getRiskClass(data.comfort.veryCold.risk)}">
                  ${data.comfort.veryCold.risk}
                </div>
                <div class="comfort-desc">${data.comfort.veryCold.value}</div>
              </div>
              <div class="comfort-card">
                <i class="fas fa-cloud-rain comfort-icon ${getRiskClass(data.comfort.veryWet.risk)}"></i>
                <div class="comfort-label">Very Wet Risk</div>
                <div class="comfort-value ${getRiskClass(data.comfort.veryWet.risk)}">
                  ${data.comfort.veryWet.risk}
                </div>
                <div class="comfort-desc">${data.comfort.veryWet.value}</div>
              </div>
              <div class="comfort-card">
                <i class="fas fa-wind comfort-icon ${getRiskClass(data.comfort.veryWindy.risk)}"></i>
                <div class="comfort-label">Very Windy Risk</div>
                <div class="comfort-value ${getRiskClass(data.comfort.veryWindy.risk)}">
                  ${data.comfort.veryWindy.risk}
                </div>
                <div class="comfort-desc">${data.comfort.veryWindy.value}</div>
              </div>
            </div>
          </div>
          
          <div class="forecast-section">
            <div class="section-title">
              <i class="fas fa-calendar-alt"></i>
              5-Day Forecast
            </div>
            <div class="forecast-container">
              ${data.forecast.map(day => `
                <div class="forecast-item">
                  <div class="forecast-day">${day.day}</div>
                  <i class="fas ${getWeatherIcon(day.condition)} forecast-icon"></i>
                  <div class="forecast-condition">${day.condition}</div>
                  <div class="forecast-temp">${day.temp}Â°C</div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }
      
      function showErrorState(message) {
        weatherDashboard.innerHTML = `
          <div class="error-state">
            <i class="fas fa-exclamation-triangle error-icon"></i>
            <h3>Something went wrong</h3>
            <p>${message}</p>
            <button class="location-btn" onclick="getCurrentLocation()">
              <i class="fas fa-redo"></i> Try Again
            </button>
          </div>
        `;
        loadingState.style.display = 'none';
      }
    });
  </script>
</body>
</html>
